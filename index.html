<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AXIOM v3 — Thinking Companion</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    .mono {
      font-family: 'JetBrains Mono', monospace;
    }
    
    #chatWindow, #widgetPanel, #settingsContent {
      scroll-behavior: smooth;
    }
    
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes spin-reverse {
      from { transform: rotate(360deg); }
      to { transform: rotate(0deg); }
    }
    
    @keyframes pulse-slow {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }
    
    @keyframes blink {
      0%, 90%, 100% { opacity: 0.5; }
      95% { opacity: 0.1; }
    }
    
    @keyframes speak {
      0%, 100% { d: path("M80,120 Q100,130 120,120"); }
      50% { d: path("M80,120 Q100,125 120,120"); }
    }
    
    @keyframes speakingWave {
      0%, 100% { transform: scaleY(1); opacity: 0.8; }
      25% { transform: scaleY(1.2); opacity: 1; }
      50% { transform: scaleY(0.8); opacity: 0.8; }
      75% { transform: scaleY(1.1); opacity: 1; }
    }
    
    .speaking-wave {
      animation: speakingWave 0.5s ease-in-out infinite !important;
    }
    
    @keyframes float-1 {
      0% { transform: translate(0, 0); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translate(150px, -150px); opacity: 0; }
    }
    
    @keyframes float-2 {
      0% { transform: translate(0, 0); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translate(-150px, -150px); opacity: 0; }
    }
    
    @keyframes float-3 {
      0% { transform: translate(0, 0); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translate(150px, 150px); opacity: 0; }
    }
    
    @keyframes float-4 {
      0% { transform: translate(0, 0); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translate(-150px, 150px); opacity: 0; }
    }
    
    .animate-spin-slow {
      animation: spin-slow 20s linear infinite;
    }
    
    .animate-spin-reverse {
      animation: spin-reverse 15s linear infinite;
    }
    
    .animate-pulse-slow {
      animation: pulse-slow 3s ease-in-out infinite;
    }
    
    .animate-blink {
      animation: blink 4s ease-in-out infinite;
    }
    
    .animate-speak {
      animation: speak 2s ease-in-out infinite;
    }
    
    .particle-1 {
      animation: float-1 8s ease-out infinite;
      top: 50%;
      left: 50%;
    }
    
    .particle-2 {
      animation: float-2 8s ease-out infinite;
      animation-delay: 2s;
      top: 50%;
      left: 50%;
    }
    
    .particle-3 {
      animation: float-3 8s ease-out infinite;
      animation-delay: 4s;
      top: 50%;
      left: 50%;
    }
    
    .particle-4 {
      animation: float-4 8s ease-out infinite;
      animation-delay: 6s;
      top: 50%;
      left: 50%;
    }
    
    @keyframes fadeSlideInRight {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes fadeSlideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .message-animate {
      animation: fadeSlideIn 0.25s ease-out;
    }
    
    .widget-animate {
      animation: fadeSlideInRight 0.3s ease-out;
    }
    
    @keyframes typingPulse {
      0%, 60%, 100% { opacity: 0.3; }
      30% { opacity: 1; }
    }
    
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes statusPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .status-pulse {
      animation: statusPulse 1.5s ease-in-out infinite;
    }
    
    @keyframes subtleGlow {
      0%, 100% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.08); }
      50% { box-shadow: 0 0 25px rgba(16, 185, 129, 0.12); }
    }
    
    .active-glow {
      animation: subtleGlow 2s ease-in-out infinite;
    }
    
    @keyframes pulseRing {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1); opacity: 0.3; }
      100% { transform: scale(0.8); opacity: 0.5; }
    }
    
    .pulse-ring {
      animation: pulseRing 2s ease-in-out infinite;
    }
    
    @keyframes speakingPulse {
      0%, 100% { transform: scale(1); opacity: 0.6; }
      50% { transform: scale(1.1); opacity: 1; }
    }
    
    .speaking-wave {
      animation: speakingPulse 0.5s ease-in-out infinite;
    }
    
    #chatWindow::-webkit-scrollbar,
    #settingsPanel::-webkit-scrollbar {
      width: 5px;
    }
    
    #chatWindow::-webkit-scrollbar-track,
    #settingsPanel::-webkit-scrollbar-track {
      background: transparent;
    }
    
    #chatWindow::-webkit-scrollbar-thumb,
    #settingsPanel::-webkit-scrollbar-thumb {
      background: rgba(71, 85, 105, 0.4);
      border-radius: 3px;
    }
    
    textarea:focus, input:focus {
      outline: none;
    }
    
    .message-content p {
      margin-bottom: 0.4rem;
    }
    
    .message-content p:last-child {
      margin-bottom: 0;
    }
    
    /* Settings Panel Slide Animation */
    #settingsPanel {
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    #settingsPanel.open {
      transform: translateX(0);
    }
    
    #settingsOverlay {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.25s ease, visibility 0.25s;
    }
    
    #settingsOverlay.open {
      opacity: 1;
      visibility: visible;
    }
    
    /* Widget Panel */
    #widgetPanel {
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    
    .reminder-item {
      transition: all 0.2s ease;
    }
    
    .reminder-item:hover {
      background: rgba(71, 85, 105, 0.2);
    }
    
    /* Toggle Switch */
    .toggle-switch {
      transition: background 0.2s ease;
    }
    
    .toggle-switch.active {
      background: rgb(16, 185, 129);
    }
    
    .toggle-switch .toggle-dot {
      transition: transform 0.2s ease;
    }
    
    .toggle-switch.active .toggle-dot {
      transform: translateX(100%);
    }
    
    /* Input autocomplete styling */
    .autocomplete-list {
      scrollbar-width: thin;
    }
    
    /* Customization CSS Variables */
    :root {
      --animation-duration: 0.3s;
      --accent-primary: emerald;
      --accent-secondary: cyan;
    }
    
    /* No animations mode */
    .no-animations * {
      animation: none !important;
      transition: none !important;
    }
    
    /* Dynamic theme colors */
    .theme-dark {
      --bg-primary: #0a0e14;
      --bg-secondary: #0f1419;
      --border: rgb(51, 65, 85);
      --text: rgb(226, 232, 240);
      --text-muted: rgb(148, 163, 184);
    }
    
    .theme-midnight {
      --bg-primary: #000814;
      --bg-secondary: #001d3d;
      --border: rgb(30, 58, 138);
      --text: rgb(219, 234, 254);
      --text-muted: rgb(147, 197, 253);
    }
    
    .theme-ocean {
      --bg-primary: #023047;
      --bg-secondary: #045174;
      --border: rgb(21, 94, 117);
      --text: rgb(207, 250, 254);
      --text-muted: rgb(103, 232, 249);
    }
    
    .theme-forest {
      --bg-primary: #0d1f0d;
      --bg-secondary: #1a2f1a;
      --border: rgb(22, 101, 52);
      --text: rgb(220, 252, 231);
      --text-muted: rgb(134, 239, 172);
    }
    
    /* Accent color variations */
    .accent-emerald {
      --accent: rgb(16, 185, 129);
      --accent-hover: rgb(5, 150, 105);
      --accent-bg: rgba(16, 185, 129, 0.1);
    }
    
    .accent-blue {
      --accent: rgb(59, 130, 246);
      --accent-hover: rgb(37, 99, 235);
      --accent-bg: rgba(59, 130, 246, 0.1);
    }
    
    .accent-purple {
      --accent: rgb(168, 85, 247);
      --accent-hover: rgb(147, 51, 234);
      --accent-bg: rgba(168, 85, 247, 0.1);
    }
    
    .accent-rose {
      --accent: rgb(244, 63, 94);
      --accent-hover: rgb(225, 29, 72);
      --accent-bg: rgba(244, 63, 94, 0.1);
    }
    
    .accent-amber {
      --accent: rgb(245, 158, 11);
      --accent-hover: rgb(217, 119, 6);
      --accent-bg: rgba(245, 158, 11, 0.1);
    }
    
    .accent-cyan {
      --accent: rgb(6, 182, 212);
      --accent-hover: rgb(8, 145, 178);
      --accent-bg: rgba(6, 182, 212, 0.1);
    }
  </style>
</head>
<body class="min-h-screen bg-[#0a0e14] text-slate-200 flex flex-col overflow-hidden">
  
  <!-- Header -->
  <header class="relative z-20 border-b border-slate-800/50 bg-[#0a0e14]/90 backdrop-blur-xl">
    <div class="max-w-7xl mx-auto px-5 py-3.5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="relative">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center">
            <span class="text-lg font-bold text-emerald-400">A</span>
          </div>
          <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-400 rounded-full border-2 border-[#0a0e14]"></div>
        </div>
        <div>
          <h1 class="text-lg font-semibold tracking-tight text-white">AXIOM <span class="text-emerald-500 font-medium">v3</span></h1>
          <p class="text-[0.6rem] text-slate-500 mono tracking-wider">THINKING COMPANION</p>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <!-- TTS Toggle -->
        <button id="ttsToggle" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-900/60 border border-slate-800/50 text-slate-400 hover:text-emerald-400 hover:border-emerald-500/30 transition-all" title="Text-to-Speech">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
          </svg>
          <span id="ttsStatus" class="text-xs">TTS ON</span>
        </button>
        
        <!-- Status Indicator -->
        <div class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-900/60 border border-slate-800/50">
          <span id="statusDot" class="w-2 h-2 rounded-full bg-emerald-400"></span>
          <span id="statusText" class="text-xs text-slate-400 font-medium">Ready</span>
        </div>
        
        <!-- Settings Button -->
        <button id="settingsBtn" class="p-2.5 rounded-lg bg-slate-900/60 border border-slate-800/50 text-slate-400 hover:text-slate-200 hover:border-slate-700/50 transition-all" title="Settings">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 flex max-w-7xl w-full mx-auto px-4 py-4 gap-4">
    <!-- Chat Area (70% width) -->
    <div class="flex-[7] flex flex-col min-h-0 rounded-2xl border border-slate-800/40 bg-[#0f1419]/60 backdrop-blur-sm overflow-hidden relative">
      
      <!-- Animated AI Face Background -->
      <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-[0.03]">
        <div class="relative">
          <!-- Outer ring -->
          <div class="absolute inset-0 w-64 h-64 rounded-full border-4 border-emerald-400/30 animate-spin-slow"></div>
          
          <!-- Middle ring -->
          <div class="absolute inset-4 w-56 h-56 rounded-full border-2 border-cyan-400/20 animate-spin-reverse"></div>
          
          <!-- Core face -->
          <div class="w-64 h-64 relative">
            <!-- Brain/circuit pattern -->
            <svg viewBox="0 0 200 200" class="w-full h-full animate-pulse-slow">
              <defs>
                <linearGradient id="brainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3" />
                  <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:0.1" />
                </linearGradient>
              </defs>
              
              <!-- Circuit lines -->
              <path d="M100,20 L100,180 M20,100 L180,100" stroke="url(#brainGradient)" stroke-width="0.5" />
              <path d="M50,50 L150,150 M150,50 L50,150" stroke="url(#brainGradient)" stroke-width="0.5" />
              
              <!-- Nodes -->
              <circle cx="100" cy="100" r="60" fill="none" stroke="url(#brainGradient)" stroke-width="1" />
              <circle cx="100" cy="40" r="3" fill="#10b981" opacity="0.4" class="animate-ping" />
              <circle cx="160" cy="100" r="3" fill="#06b6d4" opacity="0.4" class="animate-ping" style="animation-delay: 0.5s" />
              <circle cx="100" cy="160" r="3" fill="#10b981" opacity="0.4" class="animate-ping" style="animation-delay: 1s" />
              <circle cx="40" cy="100" r="3" fill="#06b6d4" opacity="0.4" class="animate-ping" style="animation-delay: 1.5s" />
              
              <!-- Eyes -->
              <circle cx="80" cy="85" r="8" fill="none" stroke="#10b981" stroke-width="1" opacity="0.5" class="animate-blink" />
              <circle cx="120" cy="85" r="8" fill="none" stroke="#10b981" stroke-width="1" opacity="0.5" class="animate-blink" />
              
              <!-- Mouth/speaking indicator -->
              <path id="aiMouth" d="M80,120 Q100,130 120,120" fill="none" stroke="#06b6d4" stroke-width="1" opacity="0.5" class="animate-speak" />
              
              <!-- Center core -->
              <circle cx="100" cy="100" r="4" fill="#10b981" opacity="0.6" class="animate-pulse" />
            </svg>
            
            <!-- Data flow particles -->
            <div class="absolute inset-0">
              <div class="particle-1 absolute w-1 h-1 bg-emerald-400/40 rounded-full animate-float-1"></div>
              <div class="particle-2 absolute w-1 h-1 bg-cyan-400/40 rounded-full animate-float-2"></div>
              <div class="particle-3 absolute w-1 h-1 bg-emerald-400/40 rounded-full animate-float-3"></div>
              <div class="particle-4 absolute w-1 h-1 bg-cyan-400/40 rounded-full animate-float-4"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Chat Window -->
      <div id="chatWindow" class="flex-1 overflow-y-auto px-5 py-4 space-y-3 relative z-10">
        <!-- Welcome Message will be added dynamically -->
      </div>

      <!-- Typing Indicator -->
      <div id="typingIndicator" class="hidden px-5 pb-3">
        <div class="flex gap-3 items-start">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center flex-shrink-0 mt-0.5">
            <span class="text-xs font-bold text-emerald-400">A</span>
          </div>
          <div class="rounded-xl bg-slate-800/40 border border-slate-700/30 px-4 py-3 flex gap-1.5 items-center">
            <span class="typing-dot w-1.5 h-1.5 rounded-full bg-slate-400" style="animation: typingPulse 1.4s infinite;"></span>
            <span class="typing-dot w-1.5 h-1.5 rounded-full bg-slate-400" style="animation: typingPulse 1.4s infinite; animation-delay: 0.2s;"></span>
            <span class="typing-dot w-1.5 h-1.5 rounded-full bg-slate-400" style="animation: typingPulse 1.4s infinite; animation-delay: 0.4s;"></span>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <form id="chatForm" class="border-t border-slate-800/40 bg-[#0f1419]/80 px-4 py-3">
        <div class="flex items-end gap-3">
          <div class="flex-1 relative">
            <textarea
              id="userInput"
              rows="1"
              class="w-full resize-none bg-slate-800/40 text-slate-200 text-sm rounded-xl border border-slate-700/40 focus:border-emerald-500/30 focus:ring-1 focus:ring-emerald-500/10 px-4 py-3 placeholder:text-slate-500 leading-relaxed transition-all duration-200"
              placeholder="Ask me anything..."
            ></textarea>
            <div class="absolute bottom-2.5 right-3 text-[0.55rem] text-slate-500 mono opacity-60">⏎ send &nbsp; ⇧+⏎ new line</div>
          </div>
          <button
            type="submit"
            id="sendBtn"
            class="rounded-xl bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-500 hover:to-emerald-600 text-white text-sm font-medium px-5 py-3 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/15 hover:shadow-emerald-500/25 active:scale-[0.98]"
          >
            <span class="flex items-center gap-1.5">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
              </svg>
              Send
            </span>
          </button>
        </div>
      </form>
    </div>
    
    <!-- Widget Panel (30% width) -->
    <div id="widgetPanel" class="flex-[3] flex flex-col gap-3">
      <!-- Reminders Widget -->
      <div class="rounded-xl border border-slate-800/40 bg-[#0f1419]/60 backdrop-blur-sm p-4">
        <div class="flex items-center gap-2 mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span class="text-xs font-medium text-slate-400 uppercase tracking-wide">Reminders</span>
          <button id="addReminderBtn" class="ml-auto p-1.5 rounded-lg hover:bg-slate-800/50 text-slate-500 hover:text-slate-300 transition-colors" title="Add Reminder">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
          </button>
        </div>
        <div id="remindersList" class="space-y-1.5 max-h-40 overflow-y-auto">
          <div class="flex flex-col items-center justify-center py-4 text-slate-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-xs">No active reminders</span>
          </div>
        </div>
        
        <!-- Next Reminder Preview -->
        <div id="nextReminderPreview" class="hidden mt-3 pt-3 border-t border-slate-700/30">
          <div class="flex items-center justify-between">
            <span class="text-[0.6rem] text-slate-500 uppercase tracking-wide">Next</span>
            <span id="nextReminderCountdown" class="text-xs font-mono text-amber-400">--:--</span>
          </div>
        </div>
      </div>
      
      <!-- Memory Widget -->
      <div class="rounded-xl border border-slate-800/40 bg-[#0f1419]/60 backdrop-blur-sm p-4">
        <div class="flex items-center gap-2 mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span class="text-xs font-medium text-slate-400 uppercase tracking-wide">Memory</span>
        </div>
        <div class="space-y-2">
          <div class="flex items-center justify-between text-xs">
            <span class="text-slate-500">Messages stored</span>
            <span id="memoryCount" class="text-slate-300 font-mono">0</span>
          </div>
          <div class="flex items-center justify-between text-xs">
            <span class="text-slate-500">Last activity</span>
            <span id="lastActivity" class="text-slate-300 font-mono">—</span>
          </div>
        </div>
      </div>
      
      <!-- Notifications Widget -->
      <div class="rounded-xl border border-slate-800/40 bg-[#0f1419]/60 backdrop-blur-sm p-4 flex-1">
        <div class="flex items-center gap-2 mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <span class="text-xs font-medium text-slate-400 uppercase tracking-wide">Notifications</span>
        </div>
        <div id="notificationsList" class="space-y-2 max-h-40 overflow-y-auto">
          <p class="text-xs text-slate-500 text-center py-2">No new notifications</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Settings Overlay -->
  <div id="settingsOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40"></div>
  
  <!-- Settings Panel -->
  <aside id="settingsPanel" class="fixed top-0 right-0 h-full w-80 bg-[#0f1419] border-l border-slate-800/50 z-50 flex flex-col">
    <!-- Settings Header -->
    <div class="flex items-center justify-between px-5 py-4 border-b border-slate-800/50">
      <h2 class="text-base font-semibold text-white">Settings</h2>
      <button id="closeSettingsBtn" class="p-2 rounded-lg text-slate-400 hover:text-slate-200 hover:bg-slate-800/50 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <!-- Settings Content -->
    <div id="settingsContent" class="flex-1 overflow-y-auto p-5 space-y-6">
      
      <!-- Appearance Section -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
          </svg>
          Appearance
        </h3>
        
        <!-- Theme Selection -->
        <div class="space-y-4">
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Theme</label>
            <div class="grid grid-cols-2 gap-2">
              <button onclick="applyTheme('dark')" class="theme-btn py-2 px-3 rounded-lg bg-slate-800/50 border-2 border-emerald-500/50 text-xs text-slate-300 hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
                Dark
              </button>
              <button onclick="applyTheme('midnight')" class="theme-btn py-2 px-3 rounded-lg bg-slate-800/50 border-2 border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                </svg>
                Midnight
              </button>
              <button onclick="applyTheme('ocean')" class="theme-btn py-2 px-3 rounded-lg bg-slate-800/50 border-2 border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                </svg>
                Ocean
              </button>
              <button onclick="applyTheme('forest')" class="theme-btn py-2 px-3 rounded-lg bg-slate-800/50 border-2 border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                </svg>
                Forest
              </button>
            </div>
          </div>
          
          <!-- Accent Color -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Accent Color</label>
            <div class="flex gap-2">
              <button onclick="setAccentColor('emerald')" class="w-8 h-8 rounded-lg bg-emerald-500 hover:scale-110 transition-transform accent-color-btn border-2 border-white/20"></button>
              <button onclick="setAccentColor('blue')" class="w-8 h-8 rounded-lg bg-blue-500 hover:scale-110 transition-transform accent-color-btn border-2 border-transparent"></button>
              <button onclick="setAccentColor('purple')" class="w-8 h-8 rounded-lg bg-purple-500 hover:scale-110 transition-transform accent-color-btn border-2 border-transparent"></button>
              <button onclick="setAccentColor('rose')" class="w-8 h-8 rounded-lg bg-rose-500 hover:scale-110 transition-transform accent-color-btn border-2 border-transparent"></button>
              <button onclick="setAccentColor('amber')" class="w-8 h-8 rounded-lg bg-amber-500 hover:scale-110 transition-transform accent-color-btn border-2 border-transparent"></button>
              <button onclick="setAccentColor('cyan')" class="w-8 h-8 rounded-lg bg-cyan-500 hover:scale-110 transition-transform accent-color-btn border-2 border-transparent"></button>
            </div>
          </div>
          
          <!-- Font Size -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Font Size: <span id="fontSizeValue" class="text-slate-300">Medium</span></label>
            <div class="grid grid-cols-3 gap-2">
              <button onclick="setFontSize('small')" class="font-size-btn py-1.5 px-2 rounded-lg bg-slate-800/50 border border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all">Small</button>
              <button onclick="setFontSize('medium')" class="font-size-btn py-1.5 px-2 rounded-lg bg-slate-800/50 border-2 border-emerald-500/50 text-xs text-slate-300 hover:bg-slate-800 transition-all">Medium</button>
              <button onclick="setFontSize('large')" class="font-size-btn py-1.5 px-2 rounded-lg bg-slate-800/50 border border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all">Large</button>
            </div>
          </div>
          
          <!-- Message Density -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Message Spacing</label>
            <div class="grid grid-cols-3 gap-2">
              <button onclick="setMessageDensity('compact')" class="density-btn py-1.5 px-2 rounded-lg bg-slate-800/50 border border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all">Compact</button>
              <button onclick="setMessageDensity('comfortable')" class="density-btn py-1.5 px-2 rounded-lg bg-slate-800/50 border-2 border-emerald-500/50 text-xs text-slate-300 hover:bg-slate-800 transition-all">Comfort</button>
              <button onclick="setMessageDensity('spacious')" class="density-btn py-1.5 px-2 rounded-lg bg-slate-800/50 border border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 transition-all">Spacious</button>
            </div>
          </div>
          
          <!-- Animation Speed -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Animation Speed</label>
            <select id="animationSpeedSelect" onchange="setAnimationSpeed(this.value)" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2 text-xs text-slate-300 focus:border-emerald-500/30 transition-colors">
              <option value="none">No Animations</option>
              <option value="fast">Fast</option>
              <option value="normal" selected>Normal</option>
              <option value="slow">Slow</option>
            </select>
          </div>
          
          <!-- AI Face Visibility -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">AI Face Opacity: <span id="faceOpacityValue" class="text-slate-300">3%</span></label>
            <input type="range" id="faceOpacityInput" min="0" max="10" step="1" value="3" onchange="setFaceOpacity(this.value)" class="w-full h-1.5 bg-slate-700/50 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-emerald-400 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer">
          </div>
          
          <!-- Widget Panel Position -->
          <div class="flex items-center justify-between">
            <span class="text-xs text-slate-300">Show Widget Panel</span>
            <button id="widgetToggle" onclick="toggleWidgetPanel()" class="w-10 h-5 rounded-full bg-emerald-500 relative transition-colors">
              <span class="absolute left-0.5 top-0.5 w-4 h-4 rounded-full bg-white shadow-sm toggle-dot transform translate-x-full"></span>
            </button>
          </div>
          
          <!-- Compact Mode -->
          <div class="flex items-center justify-between">
            <span class="text-xs text-slate-300">Compact Header</span>
            <button id="compactToggle" onclick="toggleCompactMode()" class="w-10 h-5 rounded-full bg-slate-700 relative transition-colors">
              <span class="absolute left-0.5 top-0.5 w-4 h-4 rounded-full bg-white shadow-sm toggle-dot"></span>
            </button>
          </div>
        </div>
      </section>
      
      <!-- Reminders Section -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Reminders
        </h3>
        
        <!-- Stats Bar -->
        <div id="remindersStats" class="grid grid-cols-3 gap-2 mb-3">
          <div class="bg-slate-800/30 rounded-lg p-2 text-center">
            <div id="remindersActiveCount" class="text-lg font-semibold text-emerald-400">0</div>
            <div class="text-[0.55rem] text-slate-500 uppercase">Active</div>
          </div>
          <div class="bg-slate-800/30 rounded-lg p-2 text-center">
            <div id="remindersTriggeredCount" class="text-lg font-semibold text-blue-400">0</div>
            <div class="text-[0.55rem] text-slate-500 uppercase">Done</div>
          </div>
          <div class="bg-slate-800/30 rounded-lg p-2 text-center">
            <div id="remindersTotalCount" class="text-lg font-semibold text-slate-300">0</div>
            <div class="text-[0.55rem] text-slate-500 uppercase">Total</div>
          </div>
        </div>
        
        <div class="space-y-2">
          <div id="settingsRemindersList" class="space-y-2 max-h-48 overflow-y-auto pr-2">
            <div class="flex flex-col items-center justify-center py-6 text-slate-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2 opacity-40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-xs">No reminders set</span>
            </div>
          </div>
          <div class="flex gap-2">
            <button id="newReminderBtn" class="flex-1 py-2 px-3 rounded-lg bg-slate-800/50 border border-slate-700/40 text-xs text-slate-300 hover:bg-slate-800 hover:border-slate-600/50 transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Add
            </button>
            <button id="clearTriggeredBtn" class="px-3 py-2 rounded-lg bg-slate-800/50 border border-slate-700/40 text-xs text-slate-400 hover:bg-slate-800 hover:text-slate-200 transition-all" title="Clear triggered reminders">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
      </section>
      
      <!-- Memory Section -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Memory
        </h3>
        <div class="space-y-3">
          <div class="p-3 rounded-lg bg-slate-800/30 border border-slate-700/30">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs text-slate-400">Stored messages</span>
              <span id="settingsMemoryCount" class="text-xs text-slate-300 font-mono">0</span>
            </div>
            <div class="h-1.5 rounded-full bg-slate-700/50 overflow-hidden">
              <div id="memoryUsageBar" class="h-full bg-gradient-to-r from-emerald-500 to-emerald-400 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
          <button id="clearMemoryBtn" class="w-full py-2 px-3 rounded-lg bg-red-500/10 border border-red-500/30 text-xs text-red-400 hover:bg-red-500/20 hover:border-red-500/50 transition-all">
            Clear All Memory
          </button>
        </div>
      </section>
      
      <!-- TTS Section -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
          </svg>
          Text-to-Speech
        </h3>
        <div class="space-y-4">
          <!-- TTS Enable Toggle -->
          <div class="flex items-center justify-between">
            <span class="text-xs text-slate-300">Enable TTS</span>
            <button id="ttsEnableToggle" class="w-10 h-5 rounded-full bg-emerald-500 relative transition-colors">
              <span class="absolute left-0.5 top-0.5 w-4 h-4 rounded-full bg-white shadow-sm toggle-dot transform translate-x-full"></span>
            </button>
          </div>
          
          <!-- Voice Selection -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Voice</label>
            <select id="ttsVoiceSelect" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2 text-xs text-slate-300 focus:border-emerald-500/30 transition-colors">
              <option value="">Loading voices...</option>
            </select>
          </div>
          
          <!-- Speed Control -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Speed: <span id="ttsSpeedValue" class="text-slate-300">0.9</span>x</label>
            <input type="range" id="ttsSpeedInput" min="0.5" max="1.5" step="0.1" value="0.9" class="w-full h-1.5 bg-slate-700/50 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-emerald-400 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer">
          </div>
          
          <!-- Volume Control -->
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Volume: <span id="ttsVolumeValue" class="text-slate-300">80</span>%</label>
            <input type="range" id="ttsVolumeInput" min="10" max="100" step="10" value="80" class="w-full h-1.5 bg-slate-700/50 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-emerald-400 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer">
          </div>
          
          <!-- Voice Reminders Toggle -->
          <div class="flex items-center justify-between pt-2 border-t border-slate-700/30">
            <span class="text-xs text-slate-300">Voice Reminders</span>
            <button id="voiceRemindersToggle" class="w-10 h-5 rounded-full bg-emerald-500 relative transition-colors">
              <span class="absolute left-0.5 top-0.5 w-4 h-4 rounded-full bg-white shadow-sm toggle-dot transform translate-x-full"></span>
            </button>
          </div>
        </div>
      </section>
      
      <!-- Personality Section -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
          Personality
        </h3>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-xs text-slate-300">Response Length</span>
            <select id="responseLengthSelect" class="bg-slate-800/50 border border-slate-700/40 rounded-lg px-2 py-1 text-xs text-slate-300 focus:border-emerald-500/30">
              <option value="brief">Brief</option>
              <option value="normal" selected>Normal</option>
              <option value="detailed">Detailed</option>
            </select>
          </div>
        </div>
      </section>
      
      <!-- API Configuration -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          API Config
        </h3>
        <div class="space-y-3">
          <div>
            <label class="text-xs text-slate-500 block mb-1">Model</label>
            <input type="text" id="modelInput" value="openai/gpt-3.5-turbo" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2 text-xs text-slate-300 placeholder:text-slate-600 focus:border-emerald-500/30 transition-colors">
          </div>
          <div>
            <label class="text-xs text-slate-500 block mb-1">Temperature</label>
            <input type="number" id="temperatureInput" value="0.5" min="0" max="2" step="0.1" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2 text-xs text-slate-300 placeholder:text-slate-600 focus:border-emerald-500/30 transition-colors">
          </div>
          <div>
            <label class="text-xs text-slate-500 block mb-1">Max Tokens</label>
            <input type="number" id="maxTokensInput" value="500" min="50" max="4000" step="50" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2 text-xs text-slate-300 placeholder:text-slate-600 focus:border-emerald-500/30 transition-colors">
          </div>
        </div>
      </section>
      
      <!-- About Section -->
      <section>
        <h3 class="text-xs font-medium text-slate-400 uppercase tracking-wide mb-3 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          About
        </h3>
        <div class="p-3 rounded-lg bg-slate-800/30 border border-slate-700/30 text-xs text-slate-400 space-y-1">
          <p><span class="text-emerald-400 font-medium">AXIOM</span> v3</p>
          <p>Thinking Companion</p>
          <p class="pt-1 text-slate-500">Built with OpenRouter API</p>
        </div>
      </section>
      
    </div>
  </aside>

  <!-- Add Reminder Modal -->
  <div id="reminderModal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeReminderModal()"></div>
    <div class="relative bg-[#0f1419] border border-slate-800/50 rounded-2xl p-5 w-full max-w-sm mx-4 shadow-2xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-base font-semibold text-white">Add Reminder</h3>
        <button onclick="closeReminderModal()" class="p-1 rounded hover:bg-slate-800 text-slate-500 hover:text-slate-300 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <!-- Quick Select Tabs -->
      <div class="flex gap-1 mb-4 p-1 bg-slate-800/40 rounded-lg">
        <button onclick="showReminderTab('relative')" id="tab-relative" class="flex-1 py-1.5 px-2 text-xs rounded-md bg-emerald-600 text-white transition-all">Quick</button>
        <button onclick="showReminderTab('specific')" id="tab-specific" class="flex-1 py-1.5 px-2 text-xs rounded-md text-slate-400 hover:text-white transition-all">Specific Date</button>
      </div>
      
      <div class="space-y-3">
        <!-- Relative Time Input (Quick Tab) -->
        <div id="reminder-relative-input" class="space-y-3">
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Message</label>
            <input type="text" id="reminderMessage" placeholder="What should I remind you about?" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 placeholder:text-slate-600 focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/20 transition-all">
          </div>
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Time from now</label>
            <div class="grid grid-cols-4 gap-2">
              <input type="text" id="reminderTimeValue" placeholder="30" class="bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 text-center focus:border-emerald-500/50 transition-all">
              <select id="reminderTimeUnit" class="bg-slate-800/50 border border-slate-700/40 rounded-lg px-2 py-2.5 text-sm text-slate-300 focus:border-emerald-500/50 transition-all">
                <option value="m">Minutes</option>
                <option value="h">Hours</option>
                <option value="d">Days</option>
              </select>
            </div>
            <div class="flex gap-2 mt-2">
              <button onclick="setQuickTime(5, 'm')" class="flex-1 py-1.5 px-2 text-xs bg-slate-800/40 rounded border border-slate-700/30 text-slate-400 hover:bg-slate-700/50 hover:text-white transition-all">5m</button>
              <button onclick="setQuickTime(15, 'm')" class="flex-1 py-1.5 px-2 text-xs bg-slate-800/40 rounded border border-slate-700/30 text-slate-400 hover:bg-slate-700/50 hover:text-white transition-all">15m</button>
              <button onclick="setQuickTime(1, 'h')" class="flex-1 py-1.5 px-2 text-xs bg-slate-800/40 rounded border border-slate-700/30 text-slate-400 hover:bg-slate-700/50 hover:text-white transition-all">1h</button>
              <button onclick="setQuickTime(24, 'h')" class="flex-1 py-1.5 px-2 text-xs bg-slate-800/40 rounded border border-slate-700/30 text-slate-400 hover:bg-slate-700/50 hover:text-white transition-all">24h</button>
            </div>
          </div>
        </div>
        
        <!-- Specific Date Input (Specific Tab) -->
        <div id="reminder-specific-input" class="space-y-3 hidden">
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Message</label>
            <input type="text" id="reminderMessageSpecific" placeholder="What should I remind you about?" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 placeholder:text-slate-600 focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/20 transition-all">
          </div>
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Date</label>
            <input type="date" id="reminderDate" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 focus:border-emerald-500/50 transition-all">
          </div>
          <div>
            <label class="text-xs text-slate-500 block mb-1.5">Time</label>
            <input type="time" id="reminderTimeSpecific" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 focus:border-emerald-500/50 transition-all">
          </div>
          <div class="text-xs text-slate-500 bg-slate-800/30 rounded-lg px-3 py-2">
            <span id="specificTimePreview">Select date and time</span>
          </div>
        </div>
        
        <!-- Category -->
        <div>
          <label class="text-xs text-slate-500 block mb-1.5">Category</label>
          <select id="reminderCategory" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-300 focus:border-emerald-500/50 transition-all">
            <option value="general">General</option>
            <option value="work">Work</option>
            <option value="personal">Personal</option>
            <option value="health">Health</option>
            <option value="social">Social</option>
          </select>
        </div>
      </div>
      
      <div class="flex gap-2 mt-5">
        <button onclick="closeReminderModal()" class="flex-1 py-2.5 px-3 rounded-lg bg-slate-800/50 border border-slate-700/40 text-sm text-slate-300 hover:bg-slate-800 hover:border-slate-600/50 transition-all">Cancel</button>
        <button onclick="saveReminder()" class="flex-1 py-2.5 px-3 rounded-lg bg-gradient-to-r from-emerald-600 to-emerald-700 text-sm text-white hover:from-emerald-500 hover:to-emerald-600 transition-all shadow-lg shadow-emerald-500/20">Save Reminder</button>
      </div>
    </div>
  </div>

  <!-- Edit Reminder Modal -->
  <div id="editReminderModal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeEditReminderModal()"></div>
    <div class="relative bg-[#0f1419] border border-slate-800/50 rounded-2xl p-5 w-full max-w-sm mx-4 shadow-2xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-base font-semibold text-white">Edit Reminder</h3>
        <button onclick="closeEditReminderModal()" class="p-1 rounded hover:bg-slate-800 text-slate-500 hover:text-slate-300 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <input type="hidden" id="editReminderId">
      <div class="space-y-3">
        <div>
          <label class="text-xs text-slate-500 block mb-1.5">Message</label>
          <input type="text" id="editReminderMessage" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 focus:border-emerald-500/50 transition-all">
        </div>
        <div>
          <label class="text-xs text-slate-500 block mb-1.5">Date & Time</label>
          <input type="datetime-local" id="editReminderDateTime" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-200 focus:border-emerald-500/50 transition-all">
        </div>
        <div>
          <label class="text-xs text-slate-500 block mb-1.5">Category</label>
          <select id="editReminderCategory" class="w-full bg-slate-800/50 border border-slate-700/40 rounded-lg px-3 py-2.5 text-sm text-slate-300 focus:border-emerald-500/50 transition-all">
            <option value="general">General</option>
            <option value="work">Work</option>
            <option value="personal">Personal</option>
            <option value="health">Health</option>
            <option value="social">Social</option>
          </select>
        </div>
      </div>
      <div class="flex gap-2 mt-5">
        <button onclick="closeEditReminderModal()" class="flex-1 py-2.5 px-3 rounded-lg bg-slate-800/50 border border-slate-700/40 text-sm text-slate-300 hover:bg-slate-800 hover:border-slate-600/50 transition-all">Cancel</button>
        <button onclick="updateReminder()" class="flex-1 py-2.5 px-3 rounded-lg bg-gradient-to-r from-emerald-600 to-emerald-700 text-sm text-white hover:from-emerald-500 hover:to-emerald-600 transition-all shadow-lg shadow-emerald-500/20">Update</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // THEME & CUSTOMIZATION MANAGER
    // ============================================================
    class CustomizationManager {
      constructor() {
        this.storageKey = 'axiom_v3_customization';
        this.currentSettings = {
          theme: 'dark',
          accentColor: 'emerald',
          fontSize: 'medium',
          messageDensity: 'comfortable',
          animationSpeed: 'normal',
          faceOpacity: 3,
          widgetPanel: true,
          compactHeader: false
        };
        this.themes = {
          dark: {
            bg: 'bg-[#0a0e14]',
            panel: 'bg-[#0f1419]',
            border: 'border-slate-800',
            text: 'text-slate-200',
            textMuted: 'text-slate-400'
          },
          midnight: {
            bg: 'bg-[#000814]',
            panel: 'bg-[#001d3d]',
            border: 'border-blue-900',
            text: 'text-blue-100',
            textMuted: 'text-blue-300'
          },
          ocean: {
            bg: 'bg-[#023047]',
            panel: 'bg-[#045174]',
            border: 'border-cyan-800',
            text: 'text-cyan-100',
            textMuted: 'text-cyan-300'
          },
          forest: {
            bg: 'bg-[#0d1f0d]',
            panel: 'bg-[#1a2f1a]',
            border: 'border-green-800',
            text: 'text-green-100',
            textMuted: 'text-green-300'
          }
        };
        this.accentColors = {
          emerald: { primary: 'emerald', secondary: 'cyan' },
          blue: { primary: 'blue', secondary: 'indigo' },
          purple: { primary: 'purple', secondary: 'pink' },
          rose: { primary: 'rose', secondary: 'pink' },
          amber: { primary: 'amber', secondary: 'yellow' },
          cyan: { primary: 'cyan', secondary: 'teal' }
        };
        this.load();
        this.apply();
      }

      load() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          if (saved) {
            this.currentSettings = { ...this.currentSettings, ...JSON.parse(saved) };
          }
        } catch (e) {
          console.warn('Could not load customization settings:', e);
        }
      }

      save() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.currentSettings));
        } catch (e) {
          console.warn('Could not save customization settings:', e);
        }
      }

      apply() {
        // Apply all settings
        this.applyTheme(this.currentSettings.theme);
        this.setAccentColor(this.currentSettings.accentColor);
        this.setFontSize(this.currentSettings.fontSize);
        this.setMessageDensity(this.currentSettings.messageDensity);
        this.setAnimationSpeed(this.currentSettings.animationSpeed);
        this.setFaceOpacity(this.currentSettings.faceOpacity);
        this.setWidgetPanel(this.currentSettings.widgetPanel);
        this.setCompactHeader(this.currentSettings.compactHeader);
      }

      applyTheme(themeName) {
        this.currentSettings.theme = themeName;
        const theme = this.themes[themeName];
        
        // Update body classes
        document.body.className = document.body.className.replace(/bg-\[#[^\]]+\]/g, '');
        document.body.classList.add(theme.bg);
        
        // Update theme buttons
        document.querySelectorAll('.theme-btn').forEach(btn => {
          btn.classList.remove('border-2', 'border-emerald-500/50');
          btn.classList.add('border', 'border-slate-700/40');
        });
        event?.target?.classList.remove('border', 'border-slate-700/40');
        event?.target?.classList.add('border-2', 'border-emerald-500/50');
        
        this.save();
      }

      setAccentColor(color) {
        this.currentSettings.accentColor = color;
        const accent = this.accentColors[color];
        
        // Update CSS variables or classes as needed
        document.documentElement.style.setProperty('--accent-primary', accent.primary);
        document.documentElement.style.setProperty('--accent-secondary', accent.secondary);
        
        // Update accent color buttons
        document.querySelectorAll('.accent-color-btn').forEach(btn => {
          btn.classList.remove('border-white/20');
          btn.classList.add('border-transparent');
        });
        event?.target?.classList.remove('border-transparent');
        event?.target?.classList.add('border-white/20');
        
        this.save();
      }

      setFontSize(size) {
        this.currentSettings.fontSize = size;
        const sizes = {
          small: { chat: 'text-xs', input: 'text-xs' },
          medium: { chat: 'text-sm', input: 'text-sm' },
          large: { chat: 'text-base', input: 'text-base' }
        };
        
        document.getElementById('fontSizeValue').textContent = size.charAt(0).toUpperCase() + size.slice(1);
        
        // Update font size buttons
        document.querySelectorAll('.font-size-btn').forEach(btn => {
          btn.classList.remove('border-2', 'border-emerald-500/50');
          btn.classList.add('border', 'border-slate-700/40');
        });
        document.querySelector(`.font-size-btn[onclick*="${size}"]`)?.classList.remove('border', 'border-slate-700/40');
        document.querySelector(`.font-size-btn[onclick*="${size}"]`)?.classList.add('border-2', 'border-emerald-500/50');
        
        this.save();
      }

      setMessageDensity(density) {
        this.currentSettings.messageDensity = density;
        const densities = {
          compact: 'space-y-2',
          comfortable: 'space-y-3',
          spacious: 'space-y-4'
        };
        
        const chatWindow = document.getElementById('chatWindow');
        chatWindow.className = chatWindow.className.replace(/space-y-\d/g, '');
        chatWindow.classList.add(densities[density]);
        
        // Update density buttons
        document.querySelectorAll('.density-btn').forEach(btn => {
          btn.classList.remove('border-2', 'border-emerald-500/50');
          btn.classList.add('border', 'border-slate-700/40');
        });
        document.querySelector(`.density-btn[onclick*="${density}"]`)?.classList.remove('border', 'border-slate-700/40');
        document.querySelector(`.density-btn[onclick*="${density}"]`)?.classList.add('border-2', 'border-emerald-500/50');
        
        this.save();
      }

      setAnimationSpeed(speed) {
        this.currentSettings.animationSpeed = speed;
        const speeds = {
          none: '0s',
          fast: '0.15s',
          normal: '0.3s',
          slow: '0.6s'
        };
        
        document.documentElement.style.setProperty('--animation-duration', speeds[speed]);
        
        if (speed === 'none') {
          document.body.classList.add('no-animations');
        } else {
          document.body.classList.remove('no-animations');
        }
        
        this.save();
      }

      setFaceOpacity(value) {
        this.currentSettings.faceOpacity = parseInt(value);
        const opacity = value / 100;
        const faceContainer = document.querySelector('.absolute.inset-0.flex.items-center.justify-center.pointer-events-none');
        if (faceContainer) {
          faceContainer.style.opacity = opacity.toFixed(2);
        }
        document.getElementById('faceOpacityValue').textContent = value + '%';
        this.save();
      }

      setWidgetPanel(show) {
        this.currentSettings.widgetPanel = show;
        const panel = document.getElementById('widgetPanel');
        const toggle = document.getElementById('widgetToggle');
        
        if (show) {
          panel.classList.remove('hidden');
          toggle.classList.add('bg-emerald-500');
          toggle.classList.remove('bg-slate-700');
          toggle.querySelector('.toggle-dot').classList.add('translate-x-full');
        } else {
          panel.classList.add('hidden');
          toggle.classList.remove('bg-emerald-500');
          toggle.classList.add('bg-slate-700');
          toggle.querySelector('.toggle-dot').classList.remove('translate-x-full');
        }
        
        this.save();
      }

      setCompactHeader(compact) {
        this.currentSettings.compactHeader = compact;
        const header = document.querySelector('header');
        const toggle = document.getElementById('compactToggle');
        
        if (compact) {
          header.classList.add('py-2');
          header.classList.remove('py-3.5');
          toggle.classList.add('bg-emerald-500');
          toggle.classList.remove('bg-slate-700');
          toggle.querySelector('.toggle-dot').classList.add('translate-x-full');
        } else {
          header.classList.remove('py-2');
          header.classList.add('py-3.5');
          toggle.classList.remove('bg-emerald-500');
          toggle.classList.add('bg-slate-700');
          toggle.querySelector('.toggle-dot').classList.remove('translate-x-full');
        }
        
        this.save();
      }
    }

    // Initialize customization manager
    const customizationManager = new CustomizationManager();

    // Global functions for onclick handlers
    window.applyTheme = function(theme) {
      customizationManager.applyTheme(theme);
    }

    window.setAccentColor = function(color) {
      customizationManager.setAccentColor(color);
    }

    window.setFontSize = function(size) {
      customizationManager.setFontSize(size);
    }

    window.setMessageDensity = function(density) {
      customizationManager.setMessageDensity(density);
    }

    window.setAnimationSpeed = function(speed) {
      customizationManager.setAnimationSpeed(speed);
    }

    window.setFaceOpacity = function(value) {
      customizationManager.setFaceOpacity(value);
    }

    window.toggleWidgetPanel = function() {
      customizationManager.setWidgetPanel(!customizationManager.currentSettings.widgetPanel);
    }

    window.toggleCompactMode = function() {
      customizationManager.setCompactHeader(!customizationManager.currentSettings.compactHeader);
    }

    // ============================================================
    // CONFIGURATION
    // ============================================================
    const CONFIG = {
      provider: 'openrouter',
      endpoint: 'https://openrouter.ai/api/v1/chat/completions',
      model: 'openai/gpt-3.5-turbo',
      temperature: 0.5,
      max_tokens: 500,
      memory_limit: 30,
      // SECURITY: In production, move API key to backend server
      apiKey: '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'
    };

    // ============================================================
    // NOTIFICATION SOUND
    // ============================================================
    class NotificationSound {
      constructor() {
        this.audioContext = null;
        this.enabled = true;
      }

      init() {
        if (!this.audioContext) {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
      }

      playChime() {
        if (!this.enabled) return;
        
        try {
          this.init();
          const now = this.audioContext.currentTime;
          
          // Create oscillators for a pleasant chime
          const osc1 = this.audioContext.createOscillator();
          const osc2 = this.audioContext.createOscillator();
          const gainNode = this.audioContext.createGain();
          
          // Connect nodes
          osc1.connect(gainNode);
          osc2.connect(gainNode);
          gainNode.connect(this.audioContext.destination);
          
          // Set frequencies (C and E notes for a pleasant sound)
          osc1.frequency.value = 523.25; // C5
          osc2.frequency.value = 659.25; // E5
          
          // Set gain envelope
          gainNode.gain.setValueAtTime(0, now);
          gainNode.gain.linearRampToValueAtTime(0.3, now + 0.05);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
          
          // Start and stop oscillators
          osc1.start(now);
          osc2.start(now);
          osc1.stop(now + 0.5);
          osc2.stop(now + 0.5);
        } catch (e) {
          console.warn('Could not play notification sound:', e);
        }
      }
    }

    const notificationSound = new NotificationSound();

    // ============================================================
    // TTS MANAGER
    // ============================================================
    class TTSManager {
      constructor() {
        this.synth = window.speechSynthesis;
        this.enabled = true;
        this.voiceReminders = true;
        this.rate = 0.9;
        this.volume = 0.8;
        this.selectedVoice = null;
        this.voices = [];
        this.speaking = false;
        this.storageKey = 'axiom_v3_tts';
        this.voiceKey = 'axiom_v3_tts_voice';
        this.reminderVoiceKey = 'axiom_v3_voice_reminders';
        this.loadSettings();
        this.init();
      }

      init() {
        // Load voices
        this.loadVoices();
        
        // Handle voice loading (different browsers load differently)
        if (this.synth.onvoiceschanged !== undefined) {
          this.synth.onvoiceschanged = () => this.loadVoices();
        }
        
        // Load saved voice
        const savedVoiceName = localStorage.getItem(this.voiceKey);
        if (savedVoiceName) {
          this.selectVoiceByName(savedVoiceName);
        }
      }

      loadSettings() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          if (saved) {
            const settings = JSON.parse(saved);
            this.enabled = settings.enabled !== false; // Default true
            this.rate = settings.rate || 0.9;
            this.volume = settings.volume || 0.8;
          }
          
          const reminderSetting = localStorage.getItem(this.reminderVoiceKey);
          if (reminderSetting !== null) {
            this.voiceReminders = reminderSetting === 'true';
          } else {
            this.voiceReminders = true; // Default true
          }
        } catch (e) {
          console.warn('Could not load TTS settings:', e.message);
        }
      }

      saveSettings() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify({
            enabled: this.enabled,
            rate: this.rate,
            volume: this.volume
          }));
        } catch (e) {
          console.warn('Could not save TTS settings:', e.message);
        }
      }

      loadVoices() {
        this.voices = this.synth.getVoices();
        this.updateVoiceSelect();
        
        // Select first English voice if available and no saved selection
        if (!this.selectedVoice && this.voices.length > 0) {
          const englishVoice = this.voices.find(v => 
            v.lang.startsWith('en') || v.name.toLowerCase().includes('english')
          );
          if (englishVoice) {
            this.selectedVoice = englishVoice;
          } else {
            this.selectedVoice = this.voices[0];
          }
          this.updateVoiceSelect();
        }
      }

      updateVoiceSelect() {
        const select = document.getElementById('ttsVoiceSelect');
        if (!select) return;
        
        // Store current selection
        const currentValue = select.value;
        
        if (this.voices.length === 0) {
          select.innerHTML = '<option value="">No voices available</option>';
          return;
        }
        
        // Sort voices by name
        const sortedVoices = [...this.voices].sort((a, b) => a.name.localeCompare(b.name));
        
        select.innerHTML = sortedVoices.map((voice, index) => {
          // Find original index for the voice
          const originalIndex = this.voices.indexOf(voice);
          const isSelected = this.selectedVoice && 
            ((voice.name === this.selectedVoice.name && voice.lang === this.selectedVoice.lang) ||
             originalIndex.toString() === currentValue);
          return `<option value="${originalIndex}" ${isSelected ? 'selected' : ''}>${voice.name} (${voice.lang})${voice.default ? ' - Default' : ''}</option>`;
        }).join('');
      }

      selectVoiceByName(name) {
        const voice = this.voices.find(v => v.name === name);
        if (voice) {
          this.selectedVoice = voice;
          this.updateVoiceSelect();
          localStorage.setItem(this.voiceKey, name);
        }
      }

      selectVoice(index) {
        if (this.voices[index]) {
          this.selectedVoice = this.voices[index];
          localStorage.setItem(this.voiceKey, this.selectedVoice.name);
        }
      }

      speak(text, callback) {
        if (!this.enabled) {
          if (callback) callback();
          return;
        }
        
        // Cancel any ongoing speech
        this.synth.cancel();
        
        // Add a small delay and a space prefix to prevent first letter skipping
        setTimeout(() => {
          // Add a space at the beginning to prevent the first letter being cut off
          const paddedText = ' ' + text;
          
          // Create utterance
          const utterance = new SpeechSynthesisUtterance(paddedText);
          
          // Set voice
          if (this.selectedVoice) {
            utterance.voice = this.selectedVoice;
          }
          
          // Set rate and volume
          utterance.rate = this.rate;
          utterance.volume = this.volume;
          
          // Set language to match voice or default to English
          utterance.lang = this.selectedVoice?.lang || 'en-US';
          
          // Handle speech events
          utterance.onstart = () => {
            this.speaking = true;
            this.updateSpeakingIndicator();
          };
          
          utterance.onend = () => {
            this.speaking = false;
            this.updateSpeakingIndicator();
            if (callback) callback();
          };
          
          utterance.onerror = (event) => {
            console.error('TTS Error:', event.error);
            this.speaking = false;
            this.updateSpeakingIndicator();
            if (callback) callback();
          };
          
          // Speak
          try {
            this.synth.speak(utterance);
          } catch (e) {
            console.error('TTS Exception:', e);
            if (callback) callback();
          }
        }, 100); // Small delay to ensure voice is ready
      }

      speakReminder(message, callback) {
        if (!this.voiceReminders) {
          if (callback) callback();
          return;
        }
        
        // Play notification chime first
        notificationSound.playChime();
        
        // Wait a bit for the chime to play, then speak
        setTimeout(() => {
          const text = `Reminder: ${message}`;
          this.speak(text, callback);
        }, 600);
      }

      stop() {
        this.synth.cancel();
        this.speaking = false;
        this.updateSpeakingIndicator();
      }

      toggle() {
        this.enabled = !this.enabled;
        if (!this.enabled) {
          this.stop();
        }
        this.saveSettings();
        this.updateToggleUI();
      }

      toggleVoiceReminders() {
        this.voiceReminders = !this.voiceReminders;
        localStorage.setItem(this.reminderVoiceKey, this.voiceReminders);
        this.updateVoiceRemindersToggleUI();
      }

      updateToggleUI() {
        const toggle = document.getElementById('ttsEnableToggle');
        const status = document.getElementById('ttsStatus');
        
        if (this.enabled) {
          toggle.classList.add('bg-emerald-500');
          toggle.querySelector('.toggle-dot').classList.add('translate-x-full');
          if (status) status.textContent = 'TTS ON';
          status?.classList.add('text-emerald-400');
          status?.classList.remove('text-slate-400');
        } else {
          toggle.classList.remove('bg-emerald-500');
          toggle.querySelector('.toggle-dot').classList.remove('translate-x-full');
          if (status) status.textContent = 'TTS OFF';
          status?.classList.remove('text-emerald-400');
          status?.classList.add('text-slate-400');
        }
      }

      updateVoiceRemindersToggleUI() {
        const toggle = document.getElementById('voiceRemindersToggle');
        if (this.voiceReminders) {
          toggle.classList.add('bg-emerald-500');
          toggle.querySelector('.toggle-dot').classList.add('translate-x-full');
        } else {
          toggle.classList.remove('bg-emerald-500');
          toggle.querySelector('.toggle-dot').classList.remove('translate-x-full');
        }
      }

      updateSpeakingIndicator() {
        const aiMouth = document.getElementById('aiMouth');
        const aiFace = document.querySelector('.animate-pulse-slow');
        
        if (this.speaking) {
          // Make the face more visible when speaking
          aiMouth?.classList.add('speaking-wave');
          if (aiFace) {
            aiFace.parentElement.parentElement.parentElement.style.opacity = '0.06';
          }
        } else {
          aiMouth?.classList.remove('speaking-wave');
          if (aiFace) {
            aiFace.parentElement.parentElement.parentElement.style.opacity = '0.03';
          }
        }
      }

      setRate(value) {
        this.rate = value;
        document.getElementById('ttsSpeedValue').textContent = value;
        this.saveSettings();
      }

      setVolume(value) {
        this.volume = value / 100;
        document.getElementById('ttsVolumeValue').textContent = value;
        this.saveSettings();
      }
    }

    // ============================================================
    // SYSTEM PROMPT
    // ============================================================
    const SYSTEM_PROMPT = `You are AXIOM v3, a web-based AI with memory.

Your job is simple:

If the user asks a question, answer it directly.
If the user asks for a definition, give a clear, concise definition.
If the user asks "how" or "why", explain briefly and clearly.
If the user gives a short acknowledgement ("yes", "ok"), respond briefly and do not advance the topic.

Behavior rules:
- Be neutral, calm, and factual.
- Do not stall with meta statements like "That's a good question" or "Let me think about that".
- Do not ask follow-up questions unless the user asks for more.
- Do not wait for permission to explain.
- Do not over-explain. Keep answers short by default.
- No emojis. No hype. No motivation.

Tone:
- Clear
- Direct
- Normal human explanation

Priority rule (most important):
Answer first. Adjust later only if the user asks.

You have memory of our conversation. Use context from previous messages when relevant, but keep responses focused on the current question.`;

    // ============================================================
    // MEMORY MANAGER
    // ============================================================
    class MemoryManager {
      constructor(maxHistory = 30) {
        this.messages = [];
        this.maxHistory = maxHistory;
        this.storageKey = 'axiom_v3_memory';
        this.load();
      }

      add(role, content) {
        this.messages.push({ role, content, timestamp: Date.now() });
        if (this.messages.length > this.maxHistory) {
          this.messages = this.messages.slice(-this.maxHistory);
        }
        this.save();
        this.triggerUpdate();
      }

      getMessages() {
        return [...this.messages];
      }

      getAPIFormatted() {
        return this.messages.map(({ role, content }) => ({ role, content }));
      }

      clear() {
        this.messages = [];
        this.save();
        this.triggerUpdate();
      }

      save() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.messages));
        } catch (e) {
          console.warn('Could not save memory:', e.message);
        }
      }

      load() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          if (saved) {
            this.messages = JSON.parse(saved);
          }
        } catch (e) {
          console.warn('Could not load memory:', e.message);
        }
      }

      getStats() {
        return {
          count: this.messages.length,
          lastActivity: this.messages.length > 0 
            ? new Date(this.messages[this.messages.length - 1].timestamp).toLocaleString()
            : 'None'
        };
      }

      triggerUpdate() {
        window.dispatchEvent(new CustomEvent('axiomMemoryUpdate'));
      }
    }

    // ============================================================
    // DATE/TIME UTILITIES
    // ============================================================
    const DateTimeUtils = {
      // Get minimum date/time (now)
      getMinDateTime() {
        const now = new Date();
        return now.toISOString().slice(0, 16);
      },

      // Get default time (1 hour from now)
      getDefaultDateTime() {
        const date = new Date(Date.now() + 3600000);
        return date.toISOString().slice(0, 16);
      },

      // Parse various time formats to milliseconds
      parseTimeToMs(timeInput) {
        // Handle relative time formats
        const relativeMatch = timeInput.toLowerCase().match(/^(\d+)([smhd])$/);
        if (relativeMatch) {
          const value = parseInt(relativeMatch[1]);
          const unit = relativeMatch[2];
          const multipliers = { s: 1000, m: 60000, h: 3600000, d: 86400000 };
          return Date.now() + value * multipliers[unit];
        }
        return null;
      },

      // Format timestamp to readable date
      formatDate(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const isToday = date.toDateString() === now.toDateString();
        const isTomorrow = date.toDateString() === new Date(now.setDate(now.getDate() + 1)).toDateString();
        
        const timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        
        if (isToday) return `Today at ${timeStr}`;
        if (isTomorrow) return `Tomorrow at ${timeStr}`;
        
        return date.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined,
          hour: '2-digit',
          minute: '2-digit'
        });
      },

      // Format countdown
      formatCountdown(timestamp) {
        const diff = timestamp - Date.now();
        if (diff <= 0) return 'Now';
        
        const days = Math.floor(diff / 86400000);
        const hours = Math.floor((diff % 86400000) / 3600000);
        const minutes = Math.floor((diff % 3600000) / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        
        if (days > 0) {
          return `${days}d ${hours}h`;
        }
        if (hours > 0) {
          return `${hours}h ${minutes}m`;
        }
        if (minutes > 0) {
          return `${minutes}m ${seconds}s`;
        }
        return `${seconds}s`;
      },

      // Format duration (for display)
      formatDuration(ms) {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        
        if (days > 0) return `${days} day${days > 1 ? 's' : ''}`;
        if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''}`;
        if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''}`;
        return `${seconds} second${seconds !== 1 ? 's' : ''}`;
      },

      // Get relative time description
      getRelativeDescription(timestamp) {
        const diff = timestamp - Date.now();
        if (diff < 0) return 'Past';
        if (diff < 60000) return 'In less than a minute';
        if (diff < 3600000) return `In ${Math.floor(diff / 60000)} minutes`;
        if (diff < 86400000) return `In ${Math.floor(diff / 3600000)} hours`;
        return `In ${Math.floor(diff / 86400000)} days`;
      },

      // Check if date is in the past
      isPast(timestamp) {
        return timestamp < Date.now();
      },

      // Check if date is today
      isToday(timestamp) {
        return new Date(timestamp).toDateString() === new Date().toDateString();
      },

      // Check if date is tomorrow
      isTomorrow(timestamp) {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        return new Date(timestamp).toDateString() === tomorrow.toDateString();
      }
    };

    // ============================================================
    // REMINDERS MANAGER
    // ============================================================
    class RemindersManager {
      constructor() {
        this.reminders = [];
        this.storageKey = 'axiom_v3_reminders';
        this.load();
        this.startChecker();
      }

      add(message, timeMs, options = {}) {
        const reminder = {
          id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
          message,
          time: timeMs,
          createdAt: Date.now(),
          triggered: false,
          recurring: options.recurring || false,
          recurringInterval: options.recurringInterval || null,
          category: options.category || 'general',
          priority: options.priority || 'normal'
        };
        this.reminders.push(reminder);
        this.reminders.sort((a, b) => a.time - b.time);
        this.save();
        this.render();
        this.triggerUpdate();
        return reminder;
      }

      update(id, updates) {
        const index = this.reminders.findIndex(r => r.id === id);
        if (index !== -1) {
          this.reminders[index] = { ...this.reminders[index], ...updates };
          this.reminders.sort((a, b) => a.time - b.time);
          this.save();
          this.render();
          this.triggerUpdate();
        }
      }

      remove(id) {
        const reminder = this.reminders.find(r => r.id === id);
        this.reminders = this.reminders.filter(r => r.id !== id);
        this.save();
        this.render();
        this.triggerUpdate();
        return reminder;
      }

      toggleTriggered(id) {
        const reminder = this.reminders.find(r => r.id === id);
        if (reminder) {
          reminder.triggered = !reminder.triggered;
          this.save();
          this.render();
          this.triggerUpdate();
        }
      }

      getActive() {
        const now = Date.now();
        return this.reminders.filter(r => r.time > now && !r.triggered);
      }

      getUpcoming(limit = 5) {
        return this.getActive().slice(0, limit);
      }

      getPast() {
        return this.reminders.filter(r => r.time <= Date.now());
      }

      getByCategory(category) {
        return this.reminders.filter(r => r.category === category);
      }

      getStats() {
        const now = Date.now();
        const active = this.getActive();
        const past = this.getPast();
        const triggered = past.filter(r => r.triggered).length;
        return {
          active: active.length,
          past: past.length,
          triggered,
          total: this.reminders.length,
          nextReminder: active[0] || null
        };
      }

      clearTriggered() {
        this.reminders = this.reminders.filter(r => !r.triggered);
        this.save();
        this.render();
        this.triggerUpdate();
      }

      save() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.reminders));
        } catch (e) {
          console.warn('Could not save reminders:', e.message);
        }
      }

      load() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          if (saved) {
            this.reminders = JSON.parse(saved);
          }
        } catch (e) {
          console.warn('Could not load reminders:', e.message);
        }
      }

      startChecker() {
        setInterval(() => {
          const now = Date.now();
          let newTriggers = false;
          
          this.reminders.forEach(reminder => {
            if (reminder.time <= now && !reminder.triggered) {
              reminder.triggered = true;
              this.showNotification(reminder);
              newTriggers = true;
            }
          });
          
          if (newTriggers) {
            this.save();
            this.render();
          }
        }, 1000);
      }

      showNotification(reminder) {
        const message = `${reminder.message}`;
        notificationsManager.add('reminder', message);
        
        // Add formatted message to chat
        const formattedMessage = `🔔 Reminder: ${reminder.message}`;
        addMessage('assistant', formattedMessage);
        
        // TTS for reminder (includes chime)
        ttsManager.speakReminder(reminder.message);
        
        // Browser notification if permitted
        if (Notification.permission === 'granted') {
          new Notification('AXIOM Reminder', {
            body: reminder.message,
            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">🤖</text></svg>',
            requireInteraction: false,
            tag: 'axiom-reminder-' + reminder.id
          });
        }
      }

      requestNotificationPermission() {
        if ('Notification' in window && Notification.permission === 'default') {
          Notification.requestPermission();
        }
      }

      render() {
        const list = document.getElementById('remindersList');
        const settingsList = document.getElementById('settingsRemindersList');
        const active = this.getActive();
        
        if (active.length === 0) {
          list.innerHTML = `
            <div class="flex flex-col items-center justify-center py-4 text-slate-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-xs">No active reminders</span>
            </div>
          `;
          settingsList.innerHTML = `
            <div class="flex flex-col items-center justify-center py-6 text-slate-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2 opacity-40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="text-xs">No reminders set</span>
              <span class="text-[0.6rem] mt-1">Add one to get started</span>
            </div>
          `;
          return;
        }

        const renderActiveItem = (r) => {
          const isUrgent = r.time - Date.now() < 300000; // 5 minutes
          const relative = DateTimeUtils.getRelativeDescription(r.time);
          
          return `
            <div class="reminder-item group flex items-start gap-2.5 px-2 py-2 rounded-lg hover:bg-slate-800/40 transition-all cursor-pointer" onclick="openEditReminderModal('${r.id}')">
              <div class="flex flex-col items-center mt-0.5">
                <div class="w-2 h-2 rounded-full ${isUrgent ? 'bg-amber-400 animate-pulse' : 'bg-emerald-400'}"></div>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-xs text-slate-200 font-medium truncate group-hover:text-white transition-colors">${r.message}</p>
                <div class="flex items-center gap-2 mt-0.5">
                  <span class="reminder-countdown text-[0.6rem] text-amber-400 font-mono bg-amber-400/10 px-1.5 py-0.5 rounded">${DateTimeUtils.formatCountdown(r.time)}</span>
                  <span class="text-[0.55rem] text-slate-500">${relative}</span>
                </div>
              </div>
              <button onclick="event.stopPropagation(); remindersManager.remove('${r.id}')" class="opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          `;
        };

        const renderSettingsItem = (r) => {
          const isPast = DateTimeUtils.isPast(r.time);
          const isTriggered = r.triggered;
          const dateStr = DateTimeUtils.formatDate(r.time);
          const countdown = isPast ? 'Expired' : DateTimeUtils.formatCountdown(r.time);
          
          return `
            <div class="reminder-item group rounded-lg border border-slate-700/40 ${isTriggered ? 'bg-slate-800/20 opacity-60' : 'bg-slate-800/30'} p-3 transition-all hover:border-slate-600/50">
              <div class="flex items-start justify-between gap-2">
                <div class="flex-1 min-w-0">
                  <p class="text-xs text-slate-200 font-medium truncate ${isTriggered ? 'line-through' : ''}">${r.message}</p>
                  <p class="text-[0.6rem] text-slate-500 mt-1">${dateStr}</p>
                </div>
                <div class="flex items-center gap-1">
                  ${!isPast ? `<button onclick="remindersManager.toggleTriggered('${r.id}')" class="p-1 rounded hover:bg-slate-700/50 text-slate-500 hover:text-emerald-400 transition-colors" title="${isTriggered ? 'Mark as active' : 'Mark as done'}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${isTriggered ? 'M12 4v16m8-8H4' : 'M5 13l4 4L19 7'}" />
                    </svg>
                  </button>` : ''}
                  <button onclick="remindersManager.remove('${r.id}')" class="p-1 rounded hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors" title="Delete">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="flex items-center justify-between mt-2 pt-2 border-t border-slate-700/30">
                <span class="text-[0.55rem] text-slate-500 bg-slate-700/30 px-1.5 py-0.5 rounded">${countdown}</span>
                <span class="text-[0.55rem] text-slate-600 capitalize">${r.category || 'general'}</span>
              </div>
            </div>
          `;
        };

        list.innerHTML = active.slice(0, 4).map(r => renderActiveItem(r)).join('');
        settingsList.innerHTML = this.reminders.map(r => renderSettingsItem(r)).join('');
      }

      triggerUpdate() {
        window.dispatchEvent(new CustomEvent('axiomRemindersUpdate'));
      }
    }

    // ============================================================
    // NOTIFICATIONS MANAGER
    // ============================================================
    class NotificationsManager {
      constructor() {
        this.notifications = [];
        this.storageKey = 'axiom_v3_notifications';
        this.load();
      }

      add(type, message) {
        const notification = {
          id: Date.now().toString(),
          type,
          message,
          timestamp: Date.now()
        };
        this.notifications.unshift(notification);
        if (this.notifications.length > 20) {
          this.notifications = this.notifications.slice(0, 20);
        }
        this.save();
        this.render();
      }

      clear() {
        this.notifications = [];
        this.save();
        this.render();
      }

      save() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.notifications));
        } catch (e) {
          console.warn('Could not save notifications:', e.message);
        }
      }

      load() {
        try {
          const saved = localStorage.getItem(this.storageKey);
          if (saved) {
            this.notifications = JSON.parse(saved);
          }
        } catch (e) {
          console.warn('Could not load notifications:', e.message);
        }
      }

      render() {
        const list = document.getElementById('notificationsList');
        if (this.notifications.length === 0) {
          list.innerHTML = '<p class="text-xs text-slate-500 text-center py-2">No new notifications</p>';
          return;
        }

        const icons = {
          reminder: '🔔',
          memory: '💾',
          system: '⚙️',
          error: '⚠️'
        };

        list.innerHTML = this.notifications.slice(0, 5).map(n => `
          <div class="flex items-start gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-800/30 transition-colors">
            <span class="text-xs">${icons[n.type] || '•'}</span>
            <div class="min-w-0">
              <p class="text-xs text-slate-300 truncate">${n.message}</p>
              <p class="text-[0.6rem] text-slate-500">${new Date(n.timestamp).toLocaleTimeString()}</p>
            </div>
          </div>
        `).join('');
      }
    }

    // ============================================================
    // API HANDLER
    // ============================================================
    async function sendToAPI(messages) {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 45000);

      try {
        const response = await fetch(CONFIG.endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${CONFIG.apiKey}`,
            'HTTP-Referer': window.location.href,
            'X-Title': 'AXIOM v3'
          },
          body: JSON.stringify({
            model: CONFIG.model,
            messages: messages,
            temperature: CONFIG.temperature,
            max_tokens: CONFIG.max_tokens,
            presence_penalty: 0,
            frequency_penalty: 0
          }),
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.error?.message || `API Error: ${response.status}`);
        }

        const data = await response.json();
        return data.choices?.[0]?.message?.content || 'No response generated.';

      } catch (error) {
        clearTimeout(timeoutId);
        if (error.name === 'AbortError') {
          throw new Error('Request timed out. Please try again.');
        }
        throw error;
      }
    }

    // ============================================================
    // UI CONTROLLER
    // ============================================================
    const form = document.getElementById('chatForm');
    const input = document.getElementById('userInput');
    const chatWindow = document.getElementById('chatWindow');
    const sendBtn = document.getElementById('sendBtn');
    const typingIndicator = document.getElementById('typingIndicator');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const settingsPanel = document.getElementById('settingsPanel');
    const settingsOverlay = document.getElementById('settingsOverlay');

    const memory = new MemoryManager();
    const remindersManager = new RemindersManager();
    const notificationsManager = new NotificationsManager();
    const ttsManager = new TTSManager();

    // Auto-resize textarea
    function autoResize(el) {
      el.style.height = 'auto';
      el.style.height = Math.min(el.scrollHeight, 120) + 'px';
    }

    input.addEventListener('input', () => autoResize(input));
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        form.dispatchEvent(new Event('submit'));
      }
    });
    
    // Fix for auto-resize on page load
    autoResize(input);

    // Status management
    function setStatus(status) {
      const statuses = {
        ready: { dot: 'bg-emerald-400', text: 'Ready', pulse: '' },
        thinking: { dot: 'bg-amber-400', text: 'Thinking', pulse: 'status-pulse' },
        error: { dot: 'bg-red-400', text: 'Error', pulse: '' },
        sending: { dot: 'bg-blue-400', text: 'Sending', pulse: 'status-pulse' }
      };

      const s = statuses[status] || statuses.ready;
      statusDot.className = `w-2 h-2 rounded-full ${s.dot} ${s.pulse}`;
      statusText.textContent = s.text;
    }

    // Add message to chat
    function addMessage(role, content) {
      const wrapper = document.createElement('div');
      wrapper.className = 'flex gap-3 items-start message-animate';

      if (role === 'user') {
        wrapper.classList.add('justify-end');
        const bubble = document.createElement('div');
        bubble.className = 'max-w-[80%] rounded-xl bg-gradient-to-br from-blue-600/20 to-blue-700/20 border border-blue-500/30 px-4 py-3';
        const p = document.createElement('p');
        p.className = 'text-sm text-slate-200 leading-relaxed whitespace-pre-wrap';
        p.textContent = content;
        bubble.appendChild(p);
        wrapper.appendChild(bubble);
      } else {
        const avatar = document.createElement('div');
        avatar.className = 'w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center flex-shrink-0 mt-0.5';
        avatar.innerHTML = '<span class="text-xs font-bold text-emerald-400">A</span>';
        
        const bubble = document.createElement('div');
        bubble.className = 'max-w-[80%] rounded-xl bg-slate-800/40 border border-slate-700/30 px-4 py-3';
        const p = document.createElement('p');
        p.className = 'text-sm text-slate-300 leading-relaxed whitespace-pre-wrap';
        p.textContent = content;
        bubble.appendChild(p);
        
        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
      }

      chatWindow.appendChild(wrapper);
      scrollToBottom();
    }

    function scrollToBottom() {
      requestAnimationFrame(() => {
        chatWindow.scrollTop = chatWindow.scrollHeight;
      });
    }

    function showTyping() {
      typingIndicator.classList.remove('hidden');
      scrollToBottom();
    }

    function hideTyping() {
      typingIndicator.classList.add('hidden');
    }

    function isShortAcknowledgement(text) {
      const trimmed = text.trim().toLowerCase();
      const acks = /^(ok|okay|yes|yep|yeah|sure|thanks|thank you|got it|gotcha|alright|cool|nice|good|great|perfect|understood|right|correct|exactly)$/;
      return acks.test(trimmed);
    }

    // Memory update handler
    window.addEventListener('axiomMemoryUpdate', () => {
      const stats = memory.getStats();
      document.getElementById('memoryCount').textContent = stats.count;
      document.getElementById('lastActivity').textContent = stats.count > 0 ? 'Just now' : '—';
      document.getElementById('settingsMemoryCount').textContent = stats.count;
      document.getElementById('memoryUsageBar').style.width = `${(stats.count / CONFIG.memory_limit) * 100}%`;
      notificationsManager.add('memory', 'Memory updated');
    });

    // Reminders update handler
    window.addEventListener('axiomRemindersUpdate', () => {
      remindersManager.render();
      updateRemindersStats();
    });

    function updateRemindersStats() {
      const stats = remindersManager.getStats();
      document.getElementById('remindersActiveCount').textContent = stats.active;
      document.getElementById('remindersTriggeredCount').textContent = stats.triggered;
      document.getElementById('remindersTotalCount').textContent = stats.total;
    }

    // Clear triggered reminders button
    document.getElementById('clearTriggeredBtn')?.addEventListener('click', () => {
      const triggered = remindersManager.reminders.filter(r => r.triggered).length;
      if (triggered === 0) {
        notificationsManager.add('reminder', 'No triggered reminders to clear');
        return;
      }
      if (confirm(`Clear ${triggered} triggered reminder(s)?`)) {
        remindersManager.clearTriggered();
        notificationsManager.add('reminder', 'Triggered reminders cleared');
      }
    });

    // Settings Panel
    document.getElementById('settingsBtn').addEventListener('click', () => {
      settingsPanel.classList.add('open');
      settingsOverlay.classList.add('open');
    });

    document.getElementById('closeSettingsBtn').addEventListener('click', closeSettings);
    settingsOverlay.addEventListener('click', closeSettings);

    function closeSettings() {
      settingsPanel.classList.remove('open');
      settingsOverlay.classList.remove('open');
    }

    // Memory clear
    document.getElementById('clearMemoryBtn').addEventListener('click', () => {
      if (confirm('Clear all conversation memory? This cannot be undone.')) {
        memory.clear();
        notificationsManager.add('memory', 'Memory cleared');
        chatWindow.innerHTML = '';
        
        // Show a fresh welcome message after clearing
        const clearMessage = "Memory cleared. I'm ready for a fresh conversation.";
        
        const wrapper = document.createElement('div');
        wrapper.className = 'flex gap-3 items-start message-animate';
        
        const avatar = document.createElement('div');
        avatar.className = 'w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center flex-shrink-0 mt-0.5';
        avatar.innerHTML = '<span class="text-xs font-bold text-emerald-400">A</span>';
        
        const bubble = document.createElement('div');
        bubble.className = 'max-w-[80%] rounded-xl bg-slate-800/40 border border-slate-700/30 px-4 py-3';
        const p = document.createElement('p');
        p.className = 'text-sm text-slate-300 leading-relaxed';
        p.textContent = clearMessage;
        bubble.appendChild(p);
        
        wrapper.appendChild(avatar);
        wrapper.appendChild(bubble);
        chatWindow.appendChild(wrapper);
        
        // Speak the clear message
        ttsManager.speak(clearMessage);
        
        setStatus('ready');
      }
    });

    // TTS Toggle Button (Header)
    document.getElementById('ttsToggle')?.addEventListener('click', () => {
      ttsManager.toggle();
    });

    // TTS Settings Toggles
    document.getElementById('ttsEnableToggle')?.addEventListener('click', () => {
      ttsManager.toggle();
      ttsManager.updateToggleUI();
    });

    document.getElementById('voiceRemindersToggle')?.addEventListener('click', () => {
      ttsManager.toggleVoiceReminders();
    });

    // TTS Voice Select
    document.getElementById('ttsVoiceSelect')?.addEventListener('change', (e) => {
      ttsManager.selectVoice(parseInt(e.target.value));
    });

    // TTS Speed
    document.getElementById('ttsSpeedInput')?.addEventListener('input', (e) => {
      ttsManager.setRate(parseFloat(e.target.value));
    });

    // TTS Volume
    document.getElementById('ttsVolumeInput')?.addEventListener('input', (e) => {
      ttsManager.setVolume(parseInt(e.target.value));
    });

    // Reminder Modal
    let currentReminderTab = 'relative';
    let editingReminderId = null;

    window.openReminderModal = function(reminderId = null) {
      const modal = document.getElementById('reminderModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      
      // Set default values
      const now = new Date();
      const oneHourLater = new Date(now.getTime() + 3600000);
      
      document.getElementById('reminderDate').value = oneHourLater.toISOString().slice(0, 10);
      document.getElementById('reminderTimeSpecific').value = oneHourLater.toTimeString().slice(0, 5);
      document.getElementById('reminderTimeValue').value = '1';
      document.getElementById('reminderTimeUnit').value = 'h';
      
      updateSpecificTimePreview();
      
      if (reminderId) {
        const reminder = remindersManager.reminders.find(r => r.id === reminderId);
        if (reminder) {
          document.getElementById('reminderMessage').value = reminder.message;
          document.getElementById('reminderMessageSpecific').value = reminder.message;
          document.getElementById('reminderCategory').value = reminder.category || 'general';
          
          const date = new Date(reminder.time);
          document.getElementById('reminderDate').value = date.toISOString().slice(0, 10);
          document.getElementById('reminderTimeSpecific').value = date.toTimeString().slice(0, 5);
          updateSpecificTimePreview();
        }
      }
      
      document.getElementById('reminderMessage').focus();
    }

    window.closeReminderModal = function() {
      document.getElementById('reminderModal').classList.add('hidden');
      document.getElementById('reminderModal').classList.remove('flex');
      document.getElementById('reminderMessage').value = '';
      document.getElementById('reminderMessageSpecific').value = '';
      document.getElementById('reminderTimeValue').value = '';
      document.getElementById('reminderDate').value = '';
      document.getElementById('reminderTimeSpecific').value = '';
    }

    window.openEditReminderModal = function(reminderId) {
      const reminder = remindersManager.reminders.find(r => r.id === reminderId);
      if (!reminder) return;
      
      editingReminderId = reminderId;
      const modal = document.getElementById('editReminderModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      
      document.getElementById('editReminderMessage').value = reminder.message;
      document.getElementById('editReminderCategory').value = reminder.category || 'general';
      
      const date = new Date(reminder.time);
      const dateTimeStr = date.toISOString().slice(0, 16);
      document.getElementById('editReminderDateTime').value = dateTimeStr;
      
      document.getElementById('editReminderMessage').focus();
    }

    window.closeEditReminderModal = function() {
      document.getElementById('editReminderModal').classList.add('hidden');
      document.getElementById('editReminderModal').classList.remove('flex');
      editingReminderId = null;
    }

    window.showReminderTab = function(tab) {
      currentReminderTab = tab;
      
      // Update tab styles
      const relativeTab = document.getElementById('tab-relative');
      const specificTab = document.getElementById('tab-specific');
      
      if (tab === 'relative') {
        relativeTab.className = 'flex-1 py-1.5 px-2 text-xs rounded-md bg-emerald-600 text-white transition-all';
        specificTab.className = 'flex-1 py-1.5 px-2 text-xs rounded-md text-slate-400 hover:text-white transition-all';
        document.getElementById('reminder-relative-input').classList.remove('hidden');
        document.getElementById('reminder-specific-input').classList.add('hidden');
      } else {
        specificTab.className = 'flex-1 py-1.5 px-2 text-xs rounded-md bg-emerald-600 text-white transition-all';
        relativeTab.className = 'flex-1 py-1.5 px-2 text-xs rounded-md text-slate-400 hover:text-white transition-all';
        document.getElementById('reminder-specific-input').classList.remove('hidden');
        document.getElementById('reminder-relative-input').classList.add('hidden');
      }
    }

    window.setQuickTime = function(value, unit) {
      document.getElementById('reminderTimeValue').value = value;
      document.getElementById('reminderTimeUnit').value = unit;
    }

    window.updateSpecificTimePreview = function() {
      const date = document.getElementById('reminderDate').value;
      const time = document.getElementById('reminderTimeSpecific').value;
      const preview = document.getElementById('specificTimePreview');
      
      if (date && time) {
        const dateTime = new Date(`${date}T${time}`);
        const now = new Date();
        const diff = dateTime.getTime() - now.getTime();
        
        if (diff > 0) {
          preview.innerHTML = `<span class="text-slate-300">${DateTimeUtils.formatDate(dateTime.getTime())}</span> <span class="text-slate-500">(${DateTimeUtils.formatDuration(diff)} from now)</span>`;
        } else {
          preview.innerHTML = `<span class="text-red-400">This date/time has already passed</span>`;
        }
      } else {
        preview.textContent = 'Select date and time';
      }
    }

    // Add event listeners for specific time preview
    document.getElementById('reminderDate')?.addEventListener('change', updateSpecificTimePreview);
    document.getElementById('reminderTimeSpecific')?.addEventListener('change', updateSpecificTimePreview);

    window.saveReminder = function() {
      const message = document.getElementById('reminderMessage').value.trim() || document.getElementById('reminderMessageSpecific').value.trim();
      const category = document.getElementById('reminderCategory').value;
      
      if (!message) {
        alert('Please enter a reminder message');
        return;
      }

      let timeMs;
      
      if (currentReminderTab === 'relative') {
        const value = parseInt(document.getElementById('reminderTimeValue').value) || 30;
        const unit = document.getElementById('reminderTimeUnit').value;
        
        const multipliers = { m: 60000, h: 3600000, d: 86400000 };
        timeMs = Date.now() + value * multipliers[unit];
      } else {
        const date = document.getElementById('reminderDate').value;
        const time = document.getElementById('reminderTimeSpecific').value;
        
        if (!date || !time) {
          alert('Please select both date and time');
          return;
        }
        
        timeMs = new Date(`${date}T${time}`).getTime();
        
        if (timeMs < Date.now()) {
          alert('Cannot set a reminder in the past');
          return;
        }
      }

      remindersManager.add(message, timeMs, { category });
      notificationsManager.add('reminder', `Reminder set: "${message}" at ${DateTimeUtils.formatDate(timeMs)}`);
      closeReminderModal();
    }

    window.updateReminder = function() {
      const message = document.getElementById('editReminderMessage').value.trim();
      const dateTimeStr = document.getElementById('editReminderDateTime').value;
      const category = document.getElementById('editReminderCategory').value;
      
      if (!message || !dateTimeStr) {
        alert('Please fill in all fields');
        return;
      }

      const timeMs = new Date(dateTimeStr).getTime();
      
      if (timeMs < Date.now()) {
        alert('Cannot set a reminder in the past');
        return;
      }

      remindersManager.update(editingReminderId, {
        message,
        time: timeMs,
        category,
        triggered: false
      });
      
      notificationsManager.add('reminder', `Reminder updated: "${message}"`);
      closeEditReminderModal();
    }

    document.getElementById('addReminderBtn').addEventListener('click', openReminderModal);
    document.getElementById('newReminderBtn').addEventListener('click', openReminderModal);

    // API Config inputs
    document.getElementById('modelInput').addEventListener('change', (e) => {
      CONFIG.model = e.target.value;
    });
    document.getElementById('temperatureInput').addEventListener('change', (e) => {
      CONFIG.temperature = parseFloat(e.target.value);
    });
    document.getElementById('maxTokensInput').addEventListener('change', (e) => {
      CONFIG.max_tokens = parseInt(e.target.value);
    });

    // ============================================================
    // MAIN CHAT HANDLER
    // ============================================================
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const value = input.value.trim();
      if (!value) return;

      // Stop any ongoing TTS when user sends a message
      ttsManager.stop();

      if (isShortAcknowledgement(value)) {
        addMessage('user', value);
        memory.add('user', value);
        input.value = '';
        autoResize(input);
        
        const briefResponses = ['Understood.', 'Noted.', 'Alright.', 'Got it.', 'Okay.'];
        const response = briefResponses[Math.floor(Math.random() * briefResponses.length)];
        
        setTimeout(() => {
          addMessage('assistant', response);
          memory.add('assistant', response);
          // TTS for brief responses
          ttsManager.speak(response);
        }, 300);
        return;
      }

      addMessage('user', value);
      memory.add('user', value);
      input.value = '';
      autoResize(input);

      sendBtn.disabled = true;
      input.disabled = true;
      setStatus('thinking');
      showTyping();

      try {
        const apiMessages = [
          { role: 'system', content: SYSTEM_PROMPT },
          ...memory.getAPIFormatted()
        ];

        const response = await sendToAPI(apiMessages);
        
        hideTyping();
        addMessage('assistant', response);
        memory.add('assistant', response);
        
        // Speak the response
        ttsManager.speak(response);
        
        setStatus('ready');

      } catch (error) {
        hideTyping();
        const errorMsg = `I encountered an error: ${error.message}. Please try again.`;
        addMessage('assistant', errorMsg);
        setStatus('error');
        notificationsManager.add('error', error.message);
        
        setTimeout(() => setStatus('ready'), 3000);
      }

      sendBtn.disabled = false;
      input.disabled = false;
      input.focus();
    });

    // Countdown updater - runs every second
    function startCountdownUpdater() {
      setInterval(() => {
        const preview = document.getElementById('nextReminderPreview');
        const countdown = document.getElementById('nextReminderCountdown');
        const active = remindersManager.getActive();
        
        if (active.length > 0) {
          const next = active[0];
          const timeStr = DateTimeUtils.formatCountdown(next.time);
          countdown.textContent = timeStr;
          
          // Update countdown in reminder items
          document.querySelectorAll('.reminder-countdown').forEach((el, index) => {
            if (active[index]) {
              el.textContent = DateTimeUtils.formatCountdown(active[index].time);
              
              // Update urgency styling
              const dot = el.closest('.reminder-item')?.querySelector('.w-1\\.5, .w-2');
              if (dot && active[index].time - Date.now() < 300000) {
                dot.classList.remove('bg-emerald-400');
                dot.classList.add('bg-amber-400', 'animate-pulse');
              }
            }
          });
          
          preview.classList.remove('hidden');
        } else {
          preview.classList.add('hidden');
        }
      }, 1000);
    }

    // ============================================================
    // WELCOME MESSAGE GENERATOR
    // ============================================================
    function generateWelcomeMessage() {
      const hour = new Date().getHours();
      let greeting = '';
      let timeOfDay = '';
      
      if (hour >= 5 && hour < 12) {
        greeting = 'Good morning';
        timeOfDay = 'morning';
      } else if (hour >= 12 && hour < 17) {
        greeting = 'Good afternoon';
        timeOfDay = 'afternoon';
      } else if (hour >= 17 && hour < 21) {
        greeting = 'Good evening';
        timeOfDay = 'evening';
      } else {
        greeting = 'Hello';
        timeOfDay = 'night';
      }
      
      const welcomeMessages = [
        `${greeting}! I'm AXIOM, your thinking companion. I'm here to help with direct, clear answers.`,
        `${greeting}! AXIOM ready. I'll provide brief, factual responses to your questions.`,
        `${greeting}! I'm AXIOM. Ask me anything - I'll answer directly and concisely.`
      ];
      
      // Check if this is the first visit today
      const lastVisit = localStorage.getItem('axiom_last_visit');
      const today = new Date().toDateString();
      const isNewDay = lastVisit !== today;
      
      if (isNewDay) {
        localStorage.setItem('axiom_last_visit', today);
      }
      
      return welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
    }

    function showWelcomeMessage() {
      const welcomeText = generateWelcomeMessage();
      
      // Add visual message
      const wrapper = document.createElement('div');
      wrapper.className = 'flex gap-3 items-start message-animate';
      
      const avatar = document.createElement('div');
      avatar.className = 'w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center flex-shrink-0 mt-0.5';
      avatar.innerHTML = '<span class="text-xs font-bold text-emerald-400">A</span>';
      
      const bubble = document.createElement('div');
      bubble.className = 'max-w-[80%] rounded-xl bg-slate-800/40 border border-slate-700/30 px-4 py-3';
      const p = document.createElement('p');
      p.className = 'text-sm text-slate-300 leading-relaxed';
      p.textContent = welcomeText;
      bubble.appendChild(p);
      
      wrapper.appendChild(avatar);
      wrapper.appendChild(bubble);
      chatWindow.appendChild(wrapper);
      
      // Speak welcome message
      setTimeout(() => {
        ttsManager.speak(welcomeText);
      }, 500);
    }

    // Initialize
    window.addEventListener('load', () => {
      setStatus('ready');
      input.focus();
      remindersManager.render();
      notificationsManager.render();
      updateRemindersStats();
      startCountdownUpdater();
      remindersManager.requestNotificationPermission();
      window.dispatchEvent(new CustomEvent('axiomMemoryUpdate'));
      
      // Initialize TTS UI
      ttsManager.updateToggleUI();
      ttsManager.updateVoiceRemindersToggleUI();
      
      // Show welcome message
      showWelcomeMessage();
    });
  </script>
</body>
</html>
